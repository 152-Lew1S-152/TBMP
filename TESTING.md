# Руководство по тестированию электронной коммерции TBMP

## 1. Подготовка к тестированию

### Предварительные требования
- Python 3.8 или выше
- Установленные зависимости из requirements.txt:
  ```
  pip install -r requirements.txt
  ```

## 2. Запуск тестов

### 2.1 Запуск всех тестов
Для запуска всех автоматизированных тестов выполните:

```bash
python run_tests.py
```

### 2.2 Запуск модульных тестов
- Тест полного цикла заказа:
  ```bash
  python -m unittest tests.test_order_flow
  ```
  
- Тест админ-панели управления заказами:
  ```bash
  python -m unittest tests.test_admin_orders
  ```

## 3. Ручное тестирование

### 3.1 Создание и оформление заказа
1. Запустите приложение: `python run.py`
2. Посетите http://localhost:5000 в браузере.
3. Войдите в систему или зарегистрируйте нового пользователя.
4. Добавьте товары в корзину.
5. Перейдите в корзину и нажмите "Оформить заказ".
6. Заполните информацию для заказа и подтвердите.
7. Проверьте, что товары удалились из корзины и заказ появился в профиле.

### 3.2 Отмена заказа
1. Войдите в систему как пользователь.
2. Перейдите в "Личный кабинет".
3. Выберите заказ со статусом "Новый" или "В обработке".
4. Нажмите кнопку "Отменить заказ".
5. Подтвердите отмену в модальном окне.
6. Проверьте, что статус заказа изменился на "Отменён".

### 3.3 Тестирование функций администратора
1. Войдите в систему как администратор (Чтобы создать администратора: `python make_admin.py имя_пользователя`).
2. Перейдите в админ-панель: `/admin`.
3. Тестирование управления заказами:
   - Просмотрите список заказов.
   - Используйте поиск для нахождения конкретных заказов.
   - Отфильтруйте заказы по статусу и дате.
   - Измените статус любого заказа и убедитесь, что изменения сохраняются.

## 4. Тестирование уведомлений по электронной почте

### 4.1 Запуск SMTP-сервера для отладки
Запустите отладочный SMTP-сервер в отдельном терминале:
```bash
python -m smtpd -c DebuggingServer -n localhost:1025
```

### 4.2 Запуск приложения с настройкой почты
В другом терминале запустите:
```bash
python run_with_mail_test.py
```

### 4.3 Процесс тестирования
1. Измените статус заказа через админ-панель.
2. Отмените заказ как пользователь.
3. Проверьте в терминале с отладочным SMTP-сервером, что письма отправляются и содержат правильную информацию.

## 5. Полезные команды

- Сбросить базу данных и создать новую:
  ```bash
  python reset_database.py
  ```

- Добавить права администратора пользователю:
  ```bash
  python make_admin.py имя_пользователя
  ```

## 6. Исправление частых проблем

### 6.1 Проблемы с базой данных
Если возникают ошибки SQLite, попробуйте:
```bash
python fix_db_lock.py
```

### 6.2 Проблемы с таблицей заказов
Если структура таблицы заказов нуждается в обновлении:
```bash
python fix_order_table.py
```
